(()=>{var t={148:t=>{var s=s||{REVISION:"ALPHA"};!function(t){"use strict";var s=!1,e=0,i=function(){if(s)return s=!1,e;var t=2*Math.random()-1,r=2*Math.random()-1,a=t*t+r*r;if(0==a||a>1)return i();var o=Math.sqrt(-2*Math.log(a)/a);return e=r*o,s=!0,t*o},r=function(t,s){return Math.random()*(s-t)+t},a=function(t,s){for(var e=0,i=t.length;e<i;e++)if(t[e]===s)return!0;return!1};t.randf=r,t.randi=function(t,s){return Math.floor(Math.random()*(s-t)+t)},t.randn=function(t,s){return t+i()*s},t.zeros=function(t){if(void 0===t||isNaN(t))return[];if("undefined"==typeof ArrayBuffer){for(var s=new Array(t),e=0;e<t;e++)s[e]=0;return s}return new Float64Array(t)},t.maxmin=function(t){if(0===t.length)return{};for(var s=t[0],e=t[0],i=0,r=0,a=t.length,o=1;o<a;o++)t[o]>s&&(s=t[o],i=o),t[o]<e&&(e=t[o],r=o);return{maxi:i,maxv:s,mini:r,minv:e,dv:s-e}},t.randperm=function(t){for(var s,e=t,i=0,r=[],a=0;a<t;a++)r[a]=a;for(;e--;)i=Math.floor(Math.random()*(e+1)),s=r[e],r[e]=r[i],r[i]=s;return r},t.weightedSample=function(t,s){for(var e=r(0,1),i=0,a=0,o=t.length;a<o;a++)if(e<(i+=s[a]))return t[a]},t.arrUnique=function(t){for(var s=[],e=0,i=t.length;e<i;e++)a(s,t[e])||s.push(t[e]);return s},t.arrContains=a,t.getopt=function(t,s,e){return void 0!==t[s]?t[s]:e}}(s),function(t){"use strict";var s=function(s,e,i,r){if("[object Array]"===Object.prototype.toString.call(s)){this.sx=1,this.sy=1,this.depth=s.length,this.w=t.zeros(this.depth),this.dw=t.zeros(this.depth);for(var a=0;a<this.depth;a++)this.w[a]=s[a]}else{this.sx=s,this.sy=e,this.depth=i;var o=s*e*i;if(this.w=t.zeros(o),this.dw=t.zeros(o),void 0===r){var h=Math.sqrt(1/(s*e*i));for(a=0;a<o;a++)this.w[a]=t.randn(0,h)}else for(a=0;a<o;a++)this.w[a]=r}};s.prototype={get:function(t,s,e){var i=(this.sx*s+t)*this.depth+e;return this.w[i]},set:function(t,s,e,i){var r=(this.sx*s+t)*this.depth+e;this.w[r]=i},add:function(t,s,e,i){var r=(this.sx*s+t)*this.depth+e;this.w[r]+=i},get_grad:function(t,s,e){var i=(this.sx*s+t)*this.depth+e;return this.dw[i]},set_grad:function(t,s,e,i){var r=(this.sx*s+t)*this.depth+e;this.dw[r]=i},add_grad:function(t,s,e,i){var r=(this.sx*s+t)*this.depth+e;this.dw[r]+=i},cloneAndZero:function(){return new s(this.sx,this.sy,this.depth,0)},clone:function(){for(var t=new s(this.sx,this.sy,this.depth,0),e=this.w.length,i=0;i<e;i++)t.w[i]=this.w[i];return t},addFrom:function(t){for(var s=0;s<this.w.length;s++)this.w[s]+=t.w[s]},addFromScaled:function(t,s){for(var e=0;e<this.w.length;e++)this.w[e]+=s*t.w[e]},setConst:function(t){for(var s=0;s<this.w.length;s++)this.w[s]=t},toJSON:function(){var t={};return t.sx=this.sx,t.sy=this.sy,t.depth=this.depth,t.w=this.w,t},fromJSON:function(s){this.sx=s.sx,this.sy=s.sy,this.depth=s.depth;var e=this.sx*this.sy*this.depth;this.w=t.zeros(e),this.dw=t.zeros(e);for(var i=0;i<e;i++)this.w[i]=s.w[i]}},t.Vol=s}(s),function(t){"use strict";var s=t.Vol;t.augment=function(e,i,r,a,o){var h;if(void 0===o&&(o=!1),void 0===r&&(r=t.randi(0,e.sx-i)),void 0===a&&(a=t.randi(0,e.sy-i)),i!==e.sx||0!==r||0!==a){h=new s(i,i,e.depth,0);for(var n=0;n<i;n++)for(var u=0;u<i;u++)if(!(n+r<0||n+r>=e.sx||u+a<0||u+a>=e.sy))for(var d=0;d<e.depth;d++)h.set(n,u,d,e.get(n+r,u+a,d))}else h=e;if(o){var _=h.cloneAndZero();for(n=0;n<h.sx;n++)for(u=0;u<h.sy;u++)for(d=0;d<h.depth;d++)_.set(n,u,d,h.get(h.sx-n-1,u,d));h=_}return h},t.img_to_vol=function(t,e){void 0===e&&(e=!1);var i=document.createElement("canvas");i.width=t.width,i.height=t.height;var r=i.getContext("2d");try{r.drawImage(t,0,0)}catch(t){if("NS_ERROR_NOT_AVAILABLE"===t.name)return!1;throw t}try{var a=r.getImageData(0,0,i.width,i.height)}catch(t){if("IndexSizeError"===t.name)return!1;throw t}for(var o=a.data,h=t.width,n=t.height,u=[],d=0;d<o.length;d++)u.push(o[d]/255-.5);var _=new s(h,n,4,0);if(_.w=u,e){var l=new s(h,n,1,0);for(d=0;d<h;d++)for(var p=0;p<n;p++)l.set(d,p,0,_.get(d,p,0));_=l}return _}}(s),function(t){"use strict";var s=t.Vol,e=function(t){t=t||{},this.out_depth=t.filters,this.sx=t.sx,this.in_depth=t.in_depth,this.in_sx=t.in_sx,this.in_sy=t.in_sy,this.sy=void 0!==t.sy?t.sy:this.sx,this.stride=void 0!==t.stride?t.stride:1,this.pad=void 0!==t.pad?t.pad:0,this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:0,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.out_sx=Math.floor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=Math.floor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="conv";var e=void 0!==t.bias_pref?t.bias_pref:0;this.filters=[];for(var i=0;i<this.out_depth;i++)this.filters.push(new s(this.sx,this.sy,this.in_depth));this.biases=new s(1,1,this.out_depth,e)};e.prototype={forward:function(t,e){this.in_act=t;for(var i=new s(this.out_sx,this.out_sy,this.out_depth,0),r=0;r<this.out_depth;r++)for(var a=this.filters[r],o=-this.pad,h=-this.pad,n=0;n<this.out_sx;o+=this.stride,n++){h=-this.pad;for(var u=0;u<this.out_sy;h+=this.stride,u++){for(var d=0,_=0;_<a.sx;_++)for(var l=0;l<a.sy;l++)for(var p=0;p<a.depth;p++){var c=h+l,y=o+_;c>=0&&c<t.sy&&y>=0&&y<t.sx&&(d+=a.w[(a.sx*l+_)*a.depth+p]*t.w[(t.sx*c+y)*t.depth+p])}d+=this.biases.w[r],i.set(n,u,r,d)}}return this.out_act=i,this.out_act},backward:function(){var s=this.in_act;s.dw=t.zeros(s.w.length);for(var e=0;e<this.out_depth;e++)for(var i=this.filters[e],r=-this.pad,a=-this.pad,o=0;o<this.out_sx;r+=this.stride,o++){a=-this.pad;for(var h=0;h<this.out_sy;a+=this.stride,h++){for(var n=this.out_act.get_grad(o,h,e),u=0;u<i.sx;u++)for(var d=0;d<i.sy;d++)for(var _=0;_<i.depth;_++){var l=a+d,p=r+u;if(l>=0&&l<s.sy&&p>=0&&p<s.sx){var c=(s.sx*l+p)*s.depth+_,y=(i.sx*d+u)*i.depth+_;i.dw[y]+=s.w[c]*n,s.dw[c]+=i.w[y]*n}}this.biases.dw[e]+=n}}},getParamsAndGrads:function(){for(var t=[],s=0;s<this.out_depth;s++)t.push({params:this.filters[s].w,grads:this.filters[s].dw,l2_decay_mul:this.l2_decay_mul,l1_decay_mul:this.l1_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},toJSON:function(){var t={};t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.in_depth=this.in_depth,t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.pad=this.pad,t.filters=[];for(var s=0;s<this.filters.length;s++)t.filters.push(this.filters[s].toJSON());return t.biases=this.biases.toJSON(),t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.sx=t.sx,this.sy=t.sy,this.stride=t.stride,this.in_depth=t.in_depth,this.filters=[],this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:1,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.pad=void 0!==t.pad?t.pad:0;for(var e=0;e<t.filters.length;e++){var i=new s(0,0,0,0);i.fromJSON(t.filters[e]),this.filters.push(i)}this.biases=new s(0,0,0,0),this.biases.fromJSON(t.biases)}};var i=function(t){t=t||{},this.out_depth=void 0!==t.num_neurons?t.num_neurons:t.filters,this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:0,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_sx=1,this.out_sy=1,this.layer_type="fc";var e=void 0!==t.bias_pref?t.bias_pref:0;this.filters=[];for(var i=0;i<this.out_depth;i++)this.filters.push(new s(1,1,this.num_inputs));this.biases=new s(1,1,this.out_depth,e)};i.prototype={forward:function(t,e){this.in_act=t;for(var i=new s(1,1,this.out_depth,0),r=t.w,a=0;a<this.out_depth;a++){for(var o=0,h=this.filters[a].w,n=0;n<this.num_inputs;n++)o+=r[n]*h[n];o+=this.biases.w[a],i.w[a]=o}return this.out_act=i,this.out_act},backward:function(){var s=this.in_act;s.dw=t.zeros(s.w.length);for(var e=0;e<this.out_depth;e++){for(var i=this.filters[e],r=this.out_act.dw[e],a=0;a<this.num_inputs;a++)s.dw[a]+=i.w[a]*r,i.dw[a]+=s.w[a]*r;this.biases.dw[e]+=r}},getParamsAndGrads:function(){for(var t=[],s=0;s<this.out_depth;s++)t.push({params:this.filters[s].w,grads:this.filters[s].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},toJSON:function(){var t={};t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.filters=[];for(var s=0;s<this.filters.length;s++)t.filters.push(this.filters[s].toJSON());return t.biases=this.biases.toJSON(),t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs,this.l1_decay_mul=void 0!==t.l1_decay_mul?t.l1_decay_mul:1,this.l2_decay_mul=void 0!==t.l2_decay_mul?t.l2_decay_mul:1,this.filters=[];for(var e=0;e<t.filters.length;e++){var i=new s(0,0,0,0);i.fromJSON(t.filters[e]),this.filters.push(i)}this.biases=new s(0,0,0,0),this.biases.fromJSON(t.biases)}},t.ConvLayer=e,t.FullyConnLayer=i}(s),function(t){"use strict";var s=t.Vol,e=function(s){s=s||{},this.sx=s.sx,this.in_depth=s.in_depth,this.in_sx=s.in_sx,this.in_sy=s.in_sy,this.sy=void 0!==s.sy?s.sy:this.sx,this.stride=void 0!==s.stride?s.stride:2,this.pad=void 0!==s.pad?s.pad:0,this.out_depth=this.in_depth,this.out_sx=Math.floor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=Math.floor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="pool",this.switchx=t.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=t.zeros(this.out_sx*this.out_sy*this.out_depth)};e.prototype={forward:function(t,e){this.in_act=t;for(var i=new s(this.out_sx,this.out_sy,this.out_depth,0),r=0,a=0;a<this.out_depth;a++)for(var o=-this.pad,h=-this.pad,n=0;n<this.out_sx;o+=this.stride,n++){h=-this.pad;for(var u=0;u<this.out_sy;h+=this.stride,u++){for(var d=-99999,_=-1,l=-1,p=0;p<this.sx;p++)for(var c=0;c<this.sy;c++){var y=h+c,f=o+p;if(y>=0&&y<t.sy&&f>=0&&f<t.sx){var m=t.get(f,y,a);m>d&&(d=m,_=f,l=y)}}this.switchx[r]=_,this.switchy[r]=l,r++,i.set(n,u,a,d)}}return this.out_act=i,this.out_act},backward:function(){var s=this.in_act;s.dw=t.zeros(s.w.length),this.out_act;for(var e=0,i=0;i<this.out_depth;i++){this.pad,this.pad;for(var r=0;r<this.out_sx;this.stride,r++){this.pad;for(var a=0;a<this.out_sy;this.stride,a++){var o=this.out_act.get_grad(r,a,i);s.add_grad(this.switchx[e],this.switchy[e],i,o),e++}}}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.in_depth=this.in_depth,t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.pad=this.pad,t},fromJSON:function(s){this.out_depth=s.out_depth,this.out_sx=s.out_sx,this.out_sy=s.out_sy,this.layer_type=s.layer_type,this.sx=s.sx,this.sy=s.sy,this.stride=s.stride,this.in_depth=s.in_depth,this.pad=void 0!==s.pad?s.pad:0,this.switchx=t.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=t.zeros(this.out_sx*this.out_sy*this.out_depth)}},t.PoolLayer=e}(s),function(t){"use strict";t.Vol;var s=function(t){t=t||{},this.out_sx=void 0!==t.out_sx?t.out_sx:t.in_sx,this.out_sy=void 0!==t.out_sy?t.out_sy:t.in_sy,this.out_depth=void 0!==t.out_depth?t.out_depth:t.in_depth,this.layer_type="input"};s.prototype={forward:function(t,s){return this.in_act=t,this.out_act=t,this.out_act},backward:function(){},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.InputLayer=s}(s),function(t){"use strict";var s=t.Vol,e=function(t){t=t||{},this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="softmax"};e.prototype={forward:function(e,i){this.in_act=e;for(var r=new s(1,1,this.out_depth,0),a=e.w,o=e.w[0],h=1;h<this.out_depth;h++)a[h]>o&&(o=a[h]);var n=t.zeros(this.out_depth),u=0;for(h=0;h<this.out_depth;h++){var d=Math.exp(a[h]-o);u+=d,n[h]=d}for(h=0;h<this.out_depth;h++)n[h]/=u,r.w[h]=n[h];return this.es=n,this.out_act=r,this.out_act},backward:function(s){var e=this.in_act;e.dw=t.zeros(e.w.length);for(var i=0;i<this.out_depth;i++){var r=-((i===s?1:0)-this.es[i]);e.dw[i]=r}return-Math.log(this.es[s])},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}};var i=function(t){t=t||{},this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="regression"};i.prototype={forward:function(t,s){return this.in_act=t,this.out_act=t,t},backward:function(s){var e=this.in_act;e.dw=t.zeros(e.w.length);var i=0;if(s instanceof Array||s instanceof Float64Array)for(var r=0;r<this.out_depth;r++){var a=e.w[r]-s[r];e.dw[r]=a,i+=2*a*a}else{r=s.dim;var o=s.val;a=e.w[r]-o,e.dw[r]=a,i+=2*a*a}return i},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}};var r=function(t){t=t||{},this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="svm"};r.prototype={forward:function(t,s){return this.in_act=t,this.out_act=t,t},backward:function(s){var e=this.in_act;e.dw=t.zeros(e.w.length);for(var i=e.w[s],r=0,a=0;a<this.out_depth;a++)-i+e.w[a]+1>0&&(e.dw[a]+=1,e.dw[s]-=1,r+=-i+e.w[a]+1);return r},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}},t.RegressionLayer=i,t.SoftmaxLayer=e,t.SVMLayer=r}(s),function(t){"use strict";var s=t.Vol,e=function(t){t=t||{},this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="relu"};e.prototype={forward:function(t,s){this.in_act=t;for(var e=t.clone(),i=t.w.length,r=e.w,a=0;a<i;a++)r[a]<0&&(r[a]=0);return this.out_act=e,this.out_act},backward:function(){var s=this.in_act,e=this.out_act,i=s.w.length;s.dw=t.zeros(i);for(var r=0;r<i;r++)e.w[r]<=0?s.dw[r]=0:s.dw[r]=e.dw[r]},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}};var i=function(t){t=t||{},this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="sigmoid"};i.prototype={forward:function(t,s){this.in_act=t;for(var e=t.cloneAndZero(),i=t.w.length,r=e.w,a=t.w,o=0;o<i;o++)r[o]=1/(1+Math.exp(-a[o]));return this.out_act=e,this.out_act},backward:function(){var s=this.in_act,e=this.out_act,i=s.w.length;s.dw=t.zeros(i);for(var r=0;r<i;r++){var a=e.w[r];s.dw[r]=a*(1-a)*e.dw[r]}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}};var r=function(s){s=s||{},this.group_size=void 0!==s.group_size?s.group_size:2,this.out_sx=s.in_sx,this.out_sy=s.in_sy,this.out_depth=Math.floor(s.in_depth/this.group_size),this.layer_type="maxout",this.switches=t.zeros(this.out_sx*this.out_sy*this.out_depth)};r.prototype={forward:function(t,e){this.in_act=t;var i=this.out_depth,r=new s(this.out_sx,this.out_sy,this.out_depth,0);if(1===this.out_sx&&1===this.out_sy)for(var a=0;a<i;a++){for(var o=a*this.group_size,h=t.w[o],n=0,u=1;u<this.group_size;u++)(p=t.w[o+u])>h&&(h=p,n=u);r.w[a]=h,this.switches[a]=o+n}else for(var d=0,_=0;_<t.sx;_++)for(var l=0;l<t.sy;l++)for(a=0;a<i;a++){for(o=a*this.group_size,h=t.get(_,l,o),n=0,u=1;u<this.group_size;u++){var p;(p=t.get(_,l,o+u))>h&&(h=p,n=u)}r.set(_,l,a,h),this.switches[d]=o+n,d++}return this.out_act=r,this.out_act},backward:function(){var s=this.in_act,e=this.out_act,i=this.out_depth;if(s.dw=t.zeros(s.w.length),1===this.out_sx&&1===this.out_sy)for(var r=0;r<i;r++){var a=e.dw[r];s.dw[this.switches[r]]=a}else for(var o=0,h=0;h<e.sx;h++)for(var n=0;n<e.sy;n++)for(r=0;r<i;r++)a=e.get_grad(h,n,r),s.set_grad(h,n,this.switches[o],a),o++},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.group_size=this.group_size,t},fromJSON:function(s){this.out_depth=s.out_depth,this.out_sx=s.out_sx,this.out_sy=s.out_sy,this.layer_type=s.layer_type,this.group_size=s.group_size,this.switches=t.zeros(this.group_size)}};var a=function(t){t=t||{},this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="tanh"};a.prototype={forward:function(t,s){this.in_act=t;for(var e,i,r=t.cloneAndZero(),a=t.w.length,o=0;o<a;o++)r.w[o]=(e=t.w[o],void 0,((i=Math.exp(2*e))-1)/(i+1));return this.out_act=r,this.out_act},backward:function(){var s=this.in_act,e=this.out_act,i=s.w.length;s.dw=t.zeros(i);for(var r=0;r<i;r++){var a=e.w[r];s.dw[r]=(1-a*a)*e.dw[r]}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.TanhLayer=a,t.MaxoutLayer=r,t.ReluLayer=e,t.SigmoidLayer=i}(s),function(t){"use strict";t.Vol;var s=function(s){s=s||{},this.out_sx=s.in_sx,this.out_sy=s.in_sy,this.out_depth=s.in_depth,this.layer_type="dropout",this.drop_prob=void 0!==s.drop_prob?s.drop_prob:.5,this.dropped=t.zeros(this.out_sx*this.out_sy*this.out_depth)};s.prototype={forward:function(t,s){this.in_act=t,void 0===s&&(s=!1);var e=t.clone(),i=t.w.length;if(s)for(var r=0;r<i;r++)Math.random()<this.drop_prob?(e.w[r]=0,this.dropped[r]=!0):this.dropped[r]=!1;else for(r=0;r<i;r++)e.w[r]*=this.drop_prob;return this.out_act=e,this.out_act},backward:function(){var s=this.in_act,e=this.out_act,i=s.w.length;s.dw=t.zeros(i);for(var r=0;r<i;r++)this.dropped[r]||(s.dw[r]=e.dw[r])},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.drop_prob=this.drop_prob,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.drop_prob=t.drop_prob}},t.DropoutLayer=s}(s),function(t){"use strict";t.Vol;var s=function(t){t=t||{},this.k=t.k,this.n=t.n,this.alpha=t.alpha,this.beta=t.beta,this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="lrn",this.n%2==0&&console.log("WARNING n should be odd for LRN layer")};s.prototype={forward:function(t,s){this.in_act=t;var e=t.cloneAndZero();this.S_cache_=t.cloneAndZero();for(var i=Math.floor(this.n/2),r=0;r<t.sx;r++)for(var a=0;a<t.sy;a++)for(var o=0;o<t.depth;o++){for(var h=t.get(r,a,o),n=0,u=Math.max(0,o-i);u<=Math.min(o+i,t.depth-1);u++){var d=t.get(r,a,u);n+=d*d}n*=this.alpha/this.n,n+=this.k,this.S_cache_.set(r,a,o,n),n=Math.pow(n,this.beta),e.set(r,a,o,h/n)}return this.out_act=e,this.out_act},backward:function(){var s=this.in_act;s.dw=t.zeros(s.w.length),this.out_act;for(var e=Math.floor(this.n/2),i=0;i<s.sx;i++)for(var r=0;r<s.sy;r++)for(var a=0;a<s.depth;a++)for(var o=this.out_act.get_grad(i,r,a),h=this.S_cache_.get(i,r,a),n=Math.pow(h,this.beta),u=n*n,d=Math.max(0,a-e);d<=Math.min(a+e,s.depth-1);d++){var _=s.get(i,r,d),l=-_*this.beta*Math.pow(h,this.beta-1)*this.alpha/this.n*2*_;d===a&&(l+=n),l/=u,l*=o,s.add_grad(i,r,d,l)}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.k=this.k,t.n=this.n,t.alpha=this.alpha,t.beta=this.beta,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.out_depth=this.out_depth,t.layer_type=this.layer_type,t},fromJSON:function(t){this.k=t.k,this.n=t.n,this.alpha=t.alpha,this.beta=t.beta,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.out_depth=t.out_depth,this.layer_type=t.layer_type}},t.LocalResponseNormalizationLayer=s}(s),function(t){"use strict";var s=t.Vol,e=function(t){t=t||{},this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth+t.in_depth*t.in_depth,this.layer_type="quadtransform"};e.prototype={forward:function(t,e){this.in_act=t;for(var i=this.out_depth,r=t.depth,a=new s(this.out_sx,this.out_sy,this.out_depth,0),o=0;o<t.sx;o++)for(var h=0;h<t.sy;h++)for(var n=0;n<i;n++)if(n<r)a.set(o,h,n,t.get(o,h,n));else{var u=Math.floor((n-r)/r),d=n-r-u*r;a.set(o,h,n,t.get(o,h,u)*t.get(o,h,d))}return this.out_act=a,this.out_act},backward:function(){var s=this.in_act;s.dw=t.zeros(s.w.length);for(var e=this.out_act,i=this.out_depth,r=s.depth,a=0;a<s.sx;a++)for(var o=0;o<s.sy;o++)for(var h=0;h<i;h++){var n=e.get_grad(a,o,h);if(h<r)s.add_grad(a,o,h,n);else{var u=Math.floor((h-r)/r),d=h-r-u*r;s.add_grad(a,o,u,s.get(a,o,d)*n),s.add_grad(a,o,d,s.get(a,o,u)*n)}}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.QuadTransformLayer=e}(s),function(t){"use strict";t.Vol;var s=function(t){this.layers=[]};s.prototype={makeLayers:function(s){s.length<2&&console.log("ERROR! For now at least have input and softmax layers."),"input"!==s[0].type&&console.log("ERROR! For now first layer should be input."),s=function(){for(var t=[],e=0;e<s.length;e++){var i=s[e];if("softmax"!==i.type&&"svm"!==i.type||t.push({type:"fc",num_neurons:i.num_classes}),"regression"===i.type&&t.push({type:"fc",num_neurons:i.num_neurons}),"fc"!==i.type&&"conv"!==i.type||void 0!==i.bias_pref||(i.bias_pref=0,void 0!==i.activation&&"relu"===i.activation&&(i.bias_pref=.1)),void 0!==i.tensor&&i.tensor&&t.push({type:"quadtransform"}),t.push(i),void 0!==i.activation)if("relu"===i.activation)t.push({type:"relu"});else if("sigmoid"===i.activation)t.push({type:"sigmoid"});else if("tanh"===i.activation)t.push({type:"tanh"});else if("maxout"===i.activation){var r="undefined"!==i.group_size?i.group_size:2;t.push({type:"maxout",group_size:r})}else console.log("ERROR unsupported activation "+i.activation);void 0!==i.drop_prob&&"dropout"!==i.type&&t.push({type:"dropout",drop_prob:i.drop_prob})}return t}(),this.layers=[];for(var e=0;e<s.length;e++){var i=s[e];if(e>0){var r=this.layers[e-1];i.in_sx=r.out_sx,i.in_sy=r.out_sy,i.in_depth=r.out_depth}switch(i.type){case"fc":this.layers.push(new t.FullyConnLayer(i));break;case"lrn":this.layers.push(new t.LocalResponseNormalizationLayer(i));break;case"dropout":this.layers.push(new t.DropoutLayer(i));break;case"input":this.layers.push(new t.InputLayer(i));break;case"softmax":this.layers.push(new t.SoftmaxLayer(i));break;case"regression":this.layers.push(new t.RegressionLayer(i));break;case"conv":this.layers.push(new t.ConvLayer(i));break;case"pool":this.layers.push(new t.PoolLayer(i));break;case"relu":this.layers.push(new t.ReluLayer(i));break;case"sigmoid":this.layers.push(new t.SigmoidLayer(i));break;case"tanh":this.layers.push(new t.TanhLayer(i));break;case"maxout":this.layers.push(new t.MaxoutLayer(i));break;case"quadtransform":this.layers.push(new t.QuadTransformLayer(i));break;case"svm":this.layers.push(new t.SVMLayer(i));break;default:console.log("ERROR: UNRECOGNIZED LAYER TYPE!")}}},forward:function(t,s){void 0===s&&(s=!1);for(var e=this.layers[0].forward(t,s),i=1;i<this.layers.length;i++)e=this.layers[i].forward(e,s);return e},backward:function(t){for(var s=this.layers.length,e=this.layers[s-1].backward(t),i=s-2;i>=0;i--)this.layers[i].backward();return e},getParamsAndGrads:function(){for(var t=[],s=0;s<this.layers.length;s++)for(var e=this.layers[s].getParamsAndGrads(),i=0;i<e.length;i++)t.push(e[i]);return t},getPrediction:function(){for(var t=this.layers[this.layers.length-1].out_act.w,s=t[0],e=0,i=1;i<t.length;i++)t[i]>s&&(s=t[i],e=i);return e},toJSON:function(){for(var t={layers:[]},s=0;s<this.layers.length;s++)t.layers.push(this.layers[s].toJSON());return t},fromJSON:function(s){this.layers=[];for(var e=0;e<s.layers.length;e++){var i,r=s.layers[e],a=r.layer_type;"input"===a&&(i=new t.InputLayer),"relu"===a&&(i=new t.ReluLayer),"sigmoid"===a&&(i=new t.SigmoidLayer),"tanh"===a&&(i=new t.TanhLayer),"dropout"===a&&(i=new t.DropoutLayer),"conv"===a&&(i=new t.ConvLayer),"pool"===a&&(i=new t.PoolLayer),"lrn"===a&&(i=new t.LocalResponseNormalizationLayer),"softmax"===a&&(i=new t.SoftmaxLayer),"regression"===a&&(i=new t.RegressionLayer),"fc"===a&&(i=new t.FullyConnLayer),"maxout"===a&&(i=new t.MaxoutLayer),"quadtransform"===a&&(i=new t.QuadTransformLayer),"svm"===a&&(i=new t.SVMLayer),i.fromJSON(r),this.layers.push(i)}}},t.Net=s}(s),function(t){"use strict";t.Vol;var s=function(t,s){this.net=t,s=s||{},this.learning_rate=void 0!==s.learning_rate?s.learning_rate:.01,this.l1_decay=void 0!==s.l1_decay?s.l1_decay:0,this.l2_decay=void 0!==s.l2_decay?s.l2_decay:0,this.batch_size=void 0!==s.batch_size?s.batch_size:1,this.method=void 0!==s.method?s.method:"sgd",this.momentum=void 0!==s.momentum?s.momentum:.9,this.ro=void 0!==s.ro?s.ro:.95,this.eps=void 0!==s.eps?s.eps:1e-6,this.k=0,this.gsum=[],this.xsum=[]};s.prototype={train:function(s,e){var i=(new Date).getTime();this.net.forward(s,!0);var r=(new Date).getTime()-i,a=(i=(new Date).getTime(),this.net.backward(e)),o=0,h=0,n=(new Date).getTime()-i;if(this.k++,this.k%this.batch_size==0){var u=this.net.getParamsAndGrads();if(0===this.gsum.length&&("sgd"!==this.method||this.momentum>0))for(var d=0;d<u.length;d++)this.gsum.push(t.zeros(u[d].params.length)),"adadelta"===this.method?this.xsum.push(t.zeros(u[d].params.length)):this.xsum.push([]);for(d=0;d<u.length;d++)for(var _=u[d],l=_.params,p=_.grads,c=void 0!==_.l2_decay_mul?_.l2_decay_mul:1,y=void 0!==_.l1_decay_mul?_.l1_decay_mul:1,f=this.l2_decay*c,m=this.l1_decay*y,v=l.length,w=0;w<v;w++){o+=f*l[w]*l[w]/2,h+=m*Math.abs(l[w]);var g=m*(l[w]>0?1:-1),x=(f*l[w]+g+p[w])/this.batch_size,b=this.gsum[d],S=this.xsum[d];if("adagrad"===this.method){b[w]=b[w]+x*x;var N=-this.learning_rate/Math.sqrt(b[w]+this.eps)*x;l[w]+=N}else"windowgrad"===this.method?(b[w]=this.ro*b[w]+(1-this.ro)*x*x,N=-this.learning_rate/Math.sqrt(b[w]+this.eps)*x,l[w]+=N):"adadelta"===this.method?(b[w]=this.ro*b[w]+(1-this.ro)*x*x,N=-Math.sqrt((S[w]+this.eps)/(b[w]+this.eps))*x,S[w]=this.ro*S[w]+(1-this.ro)*N*N,l[w]+=N):this.momentum>0?(N=this.momentum*b[w]-this.learning_rate*x,b[w]=N,l[w]+=N):l[w]+=-this.learning_rate*x;p[w]=0}}return{fwd_time:r,bwd_time:n,l2_decay_loss:o,l1_decay_loss:h,cost_loss:a,softmax_loss:a,loss:a+h+o}}},t.Trainer=s,t.SGDTrainer=s}(s),function(t){"use strict";var e=t.randf,i=t.randi,r=t.Net,a=t.Trainer,o=t.maxmin,h=t.randperm,n=t.weightedSample,u=t.getopt,d=t.arrUnique,_=function(t,s,e){e=e||{},void 0===t&&(t=[]),void 0===s&&(s=[]),this.data=t,this.labels=s,this.train_ratio=u(e,"train_ratio",.7),this.num_folds=u(e,"num_folds",10),this.num_candidates=u(e,"num_candidates",50),this.num_epochs=u(e,"num_epochs",50),this.ensemble_size=u(e,"ensemble_size",10),this.batch_size_min=u(e,"batch_size_min",10),this.batch_size_max=u(e,"batch_size_max",300),this.l2_decay_min=u(e,"l2_decay_min",-4),this.l2_decay_max=u(e,"l2_decay_max",2),this.learning_rate_min=u(e,"learning_rate_min",-4),this.learning_rate_max=u(e,"learning_rate_max",0),this.momentum_min=u(e,"momentum_min",.9),this.momentum_max=u(e,"momentum_max",.9),this.neurons_min=u(e,"neurons_min",5),this.neurons_max=u(e,"neurons_max",30),this.folds=[],this.candidates=[],this.evaluated_candidates=[],this.unique_labels=d(s),this.iter=0,this.foldix=0,this.finish_fold_callback=null,this.finish_batch_callback=null,this.data.length>0&&(this.sampleFolds(),this.sampleCandidates())};_.prototype={sampleFolds:function(){var t=this.data.length,s=Math.floor(this.train_ratio*t);this.folds=[];for(var e=0;e<this.num_folds;e++){var i=h(t);this.folds.push({train_ix:i.slice(0,s),test_ix:i.slice(s,t)})}},sampleCandidate:function(){var t=this.data[0].w.length,s=this.unique_labels.length,o=[];o.push({type:"input",out_sx:1,out_sy:1,out_depth:t});for(var h=n([0,1,2,3],[.2,.3,.3,.2]),u=0;u<h;u++){var d=i(this.neurons_min,this.neurons_max),_=["tanh","maxout","relu"][i(0,3)];if(e(0,1)<.5){var l=Math.random();o.push({type:"fc",num_neurons:d,activation:_,drop_prob:l})}else o.push({type:"fc",num_neurons:d,activation:_})}o.push({type:"softmax",num_classes:s});var p=new r;p.makeLayers(o);var c,y=i(this.batch_size_min,this.batch_size_max),f=Math.pow(10,e(this.l2_decay_min,this.l2_decay_max)),m=Math.pow(10,e(this.learning_rate_min,this.learning_rate_max)),v=e(this.momentum_min,this.momentum_max),w=e(0,1),g=new a(p,c=w<.33?{method:"adadelta",batch_size:y,l2_decay:f}:w<.66?{method:"adagrad",learning_rate:m,batch_size:y,l2_decay:f}:{method:"sgd",learning_rate:m,momentum:v,batch_size:y,l2_decay:f}),x={acc:[],accv:0};return x.layer_defs=o,x.trainer_def=c,x.net=p,x.trainer=g,x},sampleCandidates:function(){this.candidates=[];for(var t=0;t<this.num_candidates;t++){var s=this.sampleCandidate();this.candidates.push(s)}},step:function(){this.iter++;for(var t=this.folds[this.foldix],s=t.train_ix[i(0,t.train_ix.length)],e=0;e<this.candidates.length;e++){var o=this.data[s],h=this.labels[s];this.candidates[e].trainer.train(o,h)}var n=this.num_epochs*t.train_ix.length;if(this.iter>=n){var u=this.evalValErrors();for(e=0;e<this.candidates.length;e++)(d=this.candidates[e]).acc.push(u[e]),d.accv+=u[e];if(this.iter=0,this.foldix++,null!==this.finish_fold_callback&&this.finish_fold_callback(),this.foldix>=this.folds.length){for(e=0;e<this.candidates.length;e++)this.evaluated_candidates.push(this.candidates[e]);this.evaluated_candidates.sort((function(t,s){return t.accv/t.acc.length>s.accv/s.acc.length?-1:1})),this.evaluated_candidates.length>3*this.ensemble_size&&(this.evaluated_candidates=this.evaluated_candidates.slice(0,3*this.ensemble_size)),null!==this.finish_batch_callback&&this.finish_batch_callback(),this.sampleCandidates(),this.foldix=0}else for(e=0;e<this.candidates.length;e++){var d=this.candidates[e],_=new r;_.makeLayers(d.layer_defs);var l=new a(_,d.trainer_def);d.net=_,d.trainer=l}}},evalValErrors:function(){for(var t=[],s=this.folds[this.foldix],e=0;e<this.candidates.length;e++){for(var i=this.candidates[e].net,r=0,a=0;a<s.test_ix.length;a++){var o=this.data[s.test_ix[a]],h=this.labels[s.test_ix[a]];i.forward(o),r+=i.getPrediction()===h?1:0}r/=s.test_ix.length,t.push(r)}return t},predict_soft:function(t){var e,i,r=Math.min(this.ensemble_size,this.evaluated_candidates.length);if(0===r)return new s.Vol(0,0,0);for(var a=0;a<r;a++){var o=this.evaluated_candidates[a].net.forward(t);if(0===a)e=o,i=o.w.length;else for(var h=0;h<i;h++)e.w[h]+=o.w[h]}for(h=0;h<i;h++)e.w[h]/=i;return e},predict:function(t){var s=this.predict_soft(t);if(0!==s.w.length)var e=o(s.w).maxi;else e=-1;return e},toJSON:function(){for(var t=Math.min(this.ensemble_size,this.evaluated_candidates.length),s={nets:[]},e=0;e<t;e++)s.nets.push(this.evaluated_candidates[e].net.toJSON());return s},fromJSON:function(t){this.ensemble_size=t.nets.length,this.evaluated_candidates=[];for(var s=0;s<this.ensemble_size;s++){var e=new r;e.fromJSON(t.nets[s]);var i={};i.net=e,this.evaluated_candidates.push(i)}},onFinishFold:function(t){this.finish_fold_callback=t},onFinishBatch:function(t){this.finish_batch_callback=t}},t.MagicNet=_}(s),function(s){"use strict";void 0===t.exports?window.jsfeat=s:t.exports=s}(s)}},s={};function e(i){var r=s[i];if(void 0!==r)return r.exports;var a=s[i]={exports:{}};return t[i](a,a.exports,e),a.exports}(()=>{"use strict";let t=!0;const s=20;var i,r,a=e(148);let o=0;var h,n;let u=0;const d=e=>{t&&(0===u||e-u>=1e3/s)&&(S(),_(),u=e),requestAnimationFrame(d)};function _(){r||(r=document.getElementById("data_canvas").getContext("2d")),r.clearRect(0,0,h,n);for(var t=new a.Vol(1,1,2),s=h/150,e=0,i=0;e<=h;e+=s,i++)for(var u=0,d=0;u<=n;u+=s,d++){t.w[0]=(e-h/2)/o,t.w[1]=(u-n/2)/o;var _=w.forward(t,!1);_.w[0]>_.w[1]?r.fillStyle="RGB(232, 254, 91)":r.fillStyle="RGB(102, 202, 144)",r.fillRect(e-s/2-1,u-s/2-1,s+2,s+2)}r.beginPath(),r.strokeStyle="rgb(50,50,50)",r.lineWidth=1,r.moveTo(0,n/2),r.lineTo(h,n/2),r.moveTo(h/2,0),r.lineTo(h/2,n),r.stroke(),r.strokeStyle="rgb(0,0,0)",r.lineWidth=1;for(var p=0;p<f;p++)1==y[p]?r.fillStyle="RGB(52, 152, 94)":r.fillStyle="RGB(182, 204, 41)",l(c[p][0]*o+h/2,c[p][1]*o+n/2,3)}function l(t,s,e){r.beginPath(),r.arc(t,s,e,0,2*Math.PI,!0),r.closePath(),r.stroke(),r.fill()}function p(t){var s,e;t.preventDefault(),t.pageX||t.pageY?(s=t.pageX,e=t.pageY):(s=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),s-=i.offsetLeft,e-=i.offsetTop,v(s,e,t.shiftKey,h,n,o)}var c,y,f;const m=()=>{c=[],y=[];for(var t=100,s=0;s<t;s++){var e=s/t*5+(0,a.randf)(-.1,.1),i=1.25*s/t*2*Math.PI+(0,a.randf)(-.1,.1);c.push([e*Math.sin(i),e*Math.cos(i)]),y.push(1)}for(s=0;s<t;s++)e=s/t*5+(0,a.randf)(-.1,.1),i=1.25*s/t*2*Math.PI+Math.PI+(0,a.randf)(-.1,.1),c.push([e*Math.sin(i),e*Math.cos(i)]),y.push(0);f=c.length,_()},v=(t,s,e,i,r,a)=>{var o=(t-i/2)/a,h=(s-r/2)/a;c.push([o,h]),y.push(e?1:0),f+=1,_()};var w,g,x;const b=()=>{T(),B(),(g=[]).push({type:"input",out_sx:1,out_sy:1,out_depth:2});for(var t=0;t<P.length;t++)g.push({type:"fc",num_neurons:P[t],activation:"tanh"});g.push({type:"softmax",num_classes:2}),(w=new a.Net).makeLayers(g),x=new a.Trainer(w,{method:"adadelta",l2_decay:.001,batch_size:10}),J()},S=()=>{for(var t=(new Date).getTime(),s=new a.Vol(1,1,2),e=0,i=0;i<20;i++)for(var r=0;r<f;r++)s.w=c[r],e+=x.train(s,y[r]).loss;e/=f*i;var o=(new Date).getTime()-t;document.getElementById("showingloss").innerHTML="loss = "+e+"<br> 100 cycles through data in "+o+"ms"};var N,z,M,L;let k=0;function O(e){t&&(0===k||e-k>=1e3/s)&&(J(),k=e),requestAnimationFrame(O)}function J(){z||(z=document.getElementById("net_canvas").getContext("2d")),z.clearRect(0,0,M,L);const t=w.layers.filter((t=>"fc"===t.layer_type||"input"===t.layer_type)),s=t.length;let e=[];for(var i=0;i<s;i++){let a=[];const o=t[i].out_depth;for(var r=0;r<o;r++){const h=M*(i+1)/(s+1),n=L*(r+1)/(o+1);a.push([h,n]),e.length>0&&e[e.length-1].forEach(((s,e)=>{let a=0;t[i].filters&&(a=t[i].filters[r].w[e]),E(s,[h,n],a)}))}e.push(a)}for(i=0;i<s;i++){const e=t[i].out_depth;for(r=0;r<e;r++){const t=M*(i+1)/(s+1),a=L*(r+1)/(e+1);z.fillStyle="rgb(250, 250, 250)",A(t,a,20)}}for(i=0;i<s;i++){const e=t[i].out_depth;for(r=0;r<e;r++){const a=M*(i+1)/(s+1),o=L*(r+1)/(e+1);if("softmax"===t[i].layer_type)z.fillStyle=0===r?"rgb(250, 150, 150)":"rgb(150, 250, 150)";else if("input"===t[i].layer_type)z.fillStyle="rgb(250, 250, 250)";else{const s=t[i].biases.w[r];z.fillStyle=I(Math.abs(s))}A(a,o,20),"input"===t[i].layer_type&&(z.textAlign="center",z.font="20px serif",z.fillStyle="rgb(0, 0, 0)",0===r?z.fillText("x",a,o+.013*L):z.fillText("y",a,o+.013*L))}}z.font="15px serif",z.fillStyle="rgb(0, 0, 0)",R>=0&&(z.textAlign="center",z.font="20px serif",z.fillStyle="rgb(0, 0, 0)",z.fillText("↑",M*(R+2)/(s+1),L))}function A(t,s,e){z.beginPath(),z.arc(t,s,e,0,2*Math.PI,!0),z.closePath(),z.lineWidth=1,z.stroke(),z.fill()}function E(t,s,e){z.strokeStyle=I(Math.abs(e)),z.beginPath(),z.moveTo(t[0],t[1]),z.lineTo(s[0],s[1]),z.lineWidth=3,z.stroke(),z.strokeStyle="black"}const I=function(t){const s=function(t,s,e){return(Math.tanh((t+s)*e/2)+1)/2},e=function(t){let s=Math.floor(t).toString(16);return 1==s.length&&(s="0"+s),s};let i=s(t=2*(t=Math.tanh(t))-1,-.2,3),r=1-s(t,.2,3),a=s(t,.6,3)+(1-s(t,-.6,3));return a-=1,"#"+e(255*i)+e(255*a*.9)+e(255*r)};let P=[6,2];var R=0;const T=()=>{0===R||0===P.length?document.getElementById("button-move-left").disabled=!0:document.getElementById("button-move-left").disabled=!1,R+1===P.length?document.getElementById("button-move-right").disabled=!0:document.getElementById("button-move-right").disabled=!1},B=()=>{1===P[R]?document.getElementById("button-delete-perceptron").disabled=!0:document.getElementById("button-delete-perceptron").disabled=!1};document.addEventListener("DOMContentLoaded",(()=>{b(),m(),(()=>{const t=document.getElementById("data_canvas_container").getBoundingClientRect(),s=(t.width>t.height?t.height:t.width)-2;i=document.getElementById("data_canvas"),r=i.getContext("2d"),i.width=s,i.height=s,h=s,n=s,o=s/11,i.addEventListener("click",p,!1),requestAnimationFrame(d)})(),(()=>{const t=document.getElementById("net_canvas_container").getBoundingClientRect(),s=(t.width>t.height?t.height:t.width)-2;N=document.getElementById("net_canvas"),z=N.getContext("2d"),N.width=s,N.height=s,M=s,L=s,requestAnimationFrame(O)})(),document.getElementById("buttonstoptrain").textContent="一時停止"})),window.demo1LNet=()=>{P=[12],loadNeuralNet()},window.demo3LNet=()=>{P=[6,2],loadNeuralNet()},window.pushNewLayer=()=>{P.push(1),1===P.length&&(R=0),loadNeuralNet(),document.getElementById("button-delete-layer").disabled=!1,document.getElementById("button-add-perceptron").disabled=!1,document.getElementById("button-delete-perceptron").disabled=!1},window.popLastLayer=()=>{P.pop(),0==P.length&&(R=-1,document.getElementById("button-delete-layer").disabled=!0,document.getElementById("button-add-perceptron").disabled=!0,document.getElementById("button-delete-perceptron").disabled=!0),loadNeuralNet()},window.moveSelectedToLeft=()=>{R>0&&(R-=1),T(),B(),J()},window.moveSelectedToRight=()=>{R<P.length-1&&(R+=1),T(),B(),J()},window.addPerceptronToSelectedLayer=()=>{P.length>0&&(P[R]+=1,loadNeuralNet())},window.deletePerceptronFromSelectedLayer=()=>{P.length>0&&P[R]>1&&(P[R]-=1,loadNeuralNet())},window.mayFes=()=>{c=(c=[[-3.34,2.52],[-2.61,3.27],[-1.7,3.95],[.11,4.07],[1.91,3.66],[2.59,2.59],[2.95,-.07],[1.5,-1.89],[-.68,-2.52],[-4.59,1.61],[-4.5,2.66],[-4.14,3.43],[-2.98,4.16],[-1.59,4.5],[-.66,4.2],[2.07,1.55],[1.14,2.93],[.25,3.41],[1.36,1.25],[1.39,.14],[.48,-1.05],[-.34,-.95],[-.57,-3.09],[-.91,-3.32],[-.57,-3.7],[-.2,-3.23],[1.64,-2.43],[1.43,-2.61],[1.48,-3.09],[1.75,-3.09],[2.11,-2.64],[2.43,-2.32],[1.84,-2.32],[2.07,-2.59],[2.45,-3.3],[2.25,-2.77],[2.64,-2.77],[1.93,-3.2],[-4.55,2.09],[-4.55,2.57],[-3.93,3.07],[-3.59,3.68],[-2.93,4.11],[-1.98,4.32],[-.82,4.55],[-.11,3.86],[.55,3.2],[1.27,3.14],[1.39,2.16],[1.82,.84],[1.82,.01],[1.11,-.84],[.59,-1.2],[.09,-1.2],[-1.3,-2.64],[-.14,-2.64],[.64,-2.55],[1.02,-2.25],[1.55,-2.09],[2.23,-1.32],[2.45,-.68],[2.52,-.23],[2.86,.59],[2.93,1.55],[3.01,2.43],[2.61,3.09],[2.52,3.09],[1.91,3.57],[1.41,3.89],[.64,4.16],[-.11,4.39],[-1.02,4.02],[-1.95,3.68],[-2.61,3.52],[-2.98,2.82],[-3.48,2.3],[-.59,-.57],[-.11,-.55],[-.11,-.02],[-.34,.23],[-.98,.09],[-1.14,-.61],[-.55,.05],[-1.05,-.09],[-.98,.3],[-.14,.61],[-.52,.61],[-.68,-.34],[-1.3,.07],[-1.11,.8],[-1.52,-.09],[-1.55,.5],[-3.23,-2.98],[-3.11,-2.52],[-3.02,-2.23],[-3.43,-2.23],[-3.7,-2.32],[-3.8,-2.52],[-3.59,-2.68],[-3.05,-2.68],[-3.43,-2.45],[1.64,1.86],[1.45,2.66],[1.05,3.34],[.66,3.75],[.41,3.73],[1.39,1.45],[1.43,.59],[1.25,-.68],[1.48,-.34],[3.52,2.39],[3.95,2.25],[3.98,2.75],[3.27,3.09],[3.8,3.23],[3.48,2.82],[3.57,2.16],[.57,1.8],[.5,2.41],[.18,2.09],[.02,2.09],[.18,1.84],[.52,1.84],[.77,2.18],[.11,2.52],[-1.68,-.93],[-1.43,-.84],[-1.5,-.68],[-1.98,-.77],[-1.52,-.5],[-1.61,-1.18],[.32,.5],[.18,.18],[-.07,.32],[.2,.73],[-.14,.75],[.5,-.09],[.05,.09],[-.27,.32],[.05,-.09],[-.32,.66],[.07,-3.82],[-.25,-3.98],[-.55,-4.52],[-.02,-4.52],[.45,-4.05],[.18,-3.98],[-.07,-4.2],[-.55,-4.32],[-.34,-3.84],[.3,-4.41],[-.39,-4.7],[.34,-4.34],[3.59,-.64],[3.07,-.75],[2.93,-.84],[2.89,-1.2],[3.43,-1.7],[4.07,-1.43],[3.61,-1.27],[3.32,-.86],[3.7,-.86],[2.89,-1.32],[2.98,-1.75],[3.05,-1.2],[3.55,-1.73],[3.41,-.5],[3.98,-.52],[4.25,.07],[3.61,.34],[3.59,-.07],[4.07,-.07],[4.05,-.41],[4.34,-.68],[4.43,-.68],[4.7,.02],[4.01,.34],[3.59,.45],[3.59,-.11],[3.86,-.25]]).map((t=>[t[0]+(0,a.randf)(0,.1),t[1]+(0,a.randf)(0,.1)])),f=(y=[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1]).length,_()},window.circleData=()=>{c=[],y=[];for(var t=0;t<50;t++){var s=(0,a.randf)(0,2),e=(0,a.randf)(0,2*Math.PI);c.push([s*Math.sin(e),s*Math.cos(e)]),y.push(1)}for(t=0;t<50;t++)s=(0,a.randf)(3,5),e=2*Math.PI*t/50,c.push([s*Math.sin(e),s*Math.cos(e)]),y.push(0);f=c.length,_()},window.spiralData=m,window.randomData=()=>{c=[],y=[];for(var t=0;t<40;t++)c.push([(0,a.randf)(-5,5),(0,a.randf)(-5,5)]),y.push((0,a.randf)(0,1)>.5?1:0);f=y.length,_()},window.loadNeuralNet=b,window.changeIsTraining=()=>{t=!t,document.getElementById("buttonstoptrain").textContent=t?"一時停止":"再開"}})()})();